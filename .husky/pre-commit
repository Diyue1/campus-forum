#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” è¿è¡Œ pre-commit æ£€æŸ¥..."

# 1. ä»£ç æ ¼å¼æ£€æŸ¥
echo "\nğŸ“ æ£€æŸ¥ä»£ç æ ¼å¼..."
npm run format

# 2. ä»£ç è´¨é‡æ£€æŸ¥
echo "\nğŸ” è¿è¡Œ ESLint..."
npm run lint

# 3. è¿è¡Œå•å…ƒæµ‹è¯•
echo "\nğŸ§ª è¿è¡Œå•å…ƒæµ‹è¯•..."
npm run test -- --run

# 4. æ£€æŸ¥æ˜¯å¦æœ‰æœªè§£å†³çš„å†²çªæ ‡è®°
echo "\nâš ï¸  æ£€æŸ¥å†²çªæ ‡è®°..."
git diff --cached --name-only | xargs grep -l "^<<<<<<< \|^=======$\|^>>>>>>> " && {
  echo "âŒ å‘ç°æœªè§£å†³çš„åˆå¹¶å†²çªï¼"
  exit 1
} || echo "âœ… æ²¡æœ‰å†²çªæ ‡è®°"

echo "\nâœ… Pre-commit æ£€æŸ¥é€šè¿‡ï¼"
